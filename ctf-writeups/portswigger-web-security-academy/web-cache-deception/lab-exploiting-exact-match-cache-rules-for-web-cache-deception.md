---
description: >-
  To solve the lab, change the email address for the user administrator. You can
  log in to your own account using the following credentials: wiener:peter.
---

# Lab: Exploiting exact-match cache rules for web cache deception

First We Login Using The Given Credential !!

<figure><img src="../../../.gitbook/assets/image (33).png" alt=""><figcaption></figcaption></figure>

We Got a web cache deception on `/Robots.txt` directory and we Notice the behaviour of the web server `X-Cache: Miss` and we send again then we got the `X-cache: Hit` !!

<figure><img src="../../../.gitbook/assets/image (34).png" alt=""><figcaption></figcaption></figure>

Let's Send again the same request and We got a `X-cache: Hit` !!

<figure><img src="../../../.gitbook/assets/image (35).png" alt=""><figcaption></figcaption></figure>

Repeat this test using the `;` delimiter instead of `?`. Notice that this receives a `200` response with your API key and the `X-Cache: miss` header. Resend and notice that this updates to `X-Cache: hit`. This indicates that the cache normalized the path to `/robots.txt` and cached the response. You can use this payload for an exploit.

<figure><img src="../../../.gitbook/assets/image (36).png" alt=""><figcaption></figcaption></figure>

### Craft an exploit <a href="#craft-an-exploit" id="craft-an-exploit"></a>

1. In **Proxy > HTTP history**, right-click the `POST /my-account/change-email` request and select **Send to Repeater**.
2. In **Repeater**, replace the CSRF token with the administrator's token.
3. Change the email address in your exploit so that it doesn't match your own.
4. Right-click the request and select **Engagement tools > Generate CSRF PoC**.
5. Click **Copy HTML**.
6. Paste the HTML into the **Body** section of the exploit server.
7. Click **Deliver exploit to victim** to solve the lab.

<figure><img src="../../../.gitbook/assets/image (29).png" alt=""><figcaption></figcaption></figure>

Right-click the request and select **Engagement tools > Generate CSRF PoC**.

Click **Copy HTML**.

<figure><img src="../../../.gitbook/assets/image (30).png" alt=""><figcaption></figcaption></figure>

Paste the HTML into the **Body** section of the exploit server.

Click **Deliver exploit to victim** to solve the lab.

<figure><img src="../../../.gitbook/assets/image (31).png" alt=""><figcaption></figcaption></figure>
